---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: authentik
  namespace: authentik
spec:
  routes:
    - kind: Rule
      match: "Host(`sso.${LOCAL_DOMAIN}`)"
      middlewares:
        - name: middlewares-authentik
          namespace: traefik
      priority: 10
      backend:
        service:
          name: authentik-server
          port:
            number: 80

    - kind: Rule
      match: "Host(`sso.${LOCAL_DOMAIN}`) && PathPrefix(`/outpost.goauthentik.io/`)"
      priority: 15
      backend:
        service:
          name: authentik-server
          port:
            number: 80
  tls:
    - hosts:
        - authentik.${LOCAL_DOMAIN}
      secretName: local-solonsstuff-com-live-tls
