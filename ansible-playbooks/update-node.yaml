---
- hosts: all
  become: true
  tasks: 
    # Update apt packages
    - name: update apt packages
      apt:
        update_cache: yes
        upgrade: yes
        cache_valid_time: 3600

     # Check if reboot is required
    - name: check if system reboot is required
      become: false
      stat:
        path: /var/run/reboot-required
      register: reboot_required
    
    # Notify me when a reboot is required
    - name: Send Discord message
      uri:
        url: "https://ntfy.solonsstuff.com/{{ ntfy_channel }}"
        method: POST
        body: "{{ inventory_hostname }} requires a reboot. üñ•Ô∏è"
        headers: 
          'Authorization': "{{ ntfy_token }}"
        follow_redirects: all
      # when: reboot_required.stat.exists